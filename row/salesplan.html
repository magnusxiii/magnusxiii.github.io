<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎšÎ¹Ï„</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
      color: #000;
      transition: background 0.3s, color 0.3s;
    }
    h2 { color: #333; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }
    input[type="number"] { width: 100px; }
    button { padding: 8px 12px; margin-top: 10px; margin-right: 5px; }
    .result { margin-top: 20px; font-size: 18px; }
    .dark-mode {
      background: #121212;
      color: #f4f4f4;
    }
    .dark-mode table { background: #1e1e1e; }
    .dark-mode th, .dark-mode td { border-color: #555; }
    .dark-mode input, .dark-mode button {
      background: #333;
      color: #f4f4f4;
      border: 1px solid #555;
    }
  </style>
</head>
<body>
  <h2>Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„</h2>

  <label><input type="checkbox" id="darkToggle" onchange="toggleDarkMode()"> ğŸŒ™ Î£ÎºÎ¿Ï„ÎµÎ¹Î½Î® Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±</label>

  <table id="itemsTable">
    <thead>
      <tr>
        <th>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</th>
        <th>Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)</th>
        <th>Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚</th>
        <th>Î§ÏÎ®ÏƒÎ· Î‘Î½Î¬ ÎšÎ¹Ï„</th>
        <th>ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„ (â‚¬)</th>
        <th>Î”Î¹Î±Î³ÏÎ±Ï†Î®</th>
      </tr>
    </thead>
    <tbody id="itemsBody">
    </tbody>
  </table>

  <button onclick="addItem()">â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î•Î¯Î´Î¿Ï…Ï‚</button>

  <div style="margin-top: 20px;">
    <label>Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ ÎšÎ¹Ï„ (â‚¬): <input type="number" id="sellPrice" placeholder="Ï€.Ï‡. 15" step="0.01"></label><br>
    <label>Î Î»Î®Î¸Î¿Ï‚ Î Î±ÏÎ±Î³Ï‰Î³Î®Ï‚: <input type="number" id="productionCount" placeholder="Ï€.Ï‡. 5" step="1"></label><br>
    <button onclick="calculateProfit()">Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎšÎ­ÏÎ´Î¿Ï…Ï‚</button>
    <button onclick="exportData()">ğŸ“¤ Î•Î¾Î±Î³Ï‰Î³Î® CSV</button>
    <button onclick="exportPDF()">ğŸ“„ Î•Î¾Î±Î³Ï‰Î³Î® PDF</button>
    <button onclick="exportExcel()">ğŸ“Š Î•Î¾Î±Î³Ï‰Î³Î® Excel</button>
  </div>

  <div class="result" id="results"></div>

  <script>
    let lastResults = {};

    function addItem(description = '', batchPrice = 0, batchQty = 1, usedPerKit = 1) {
      const tbody = document.getElementById("itemsBody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text" value="${description}"/></td>
        <td><input type="number" value="${batchPrice}" step="0.01"/></td>
        <td><input type="number" value="${batchQty}" step="1"/></td>
        <td><input type="number" value="${usedPerKit}" step="1"/></td>
        <td class="costPerKit">0.00</td>
        <td><button onclick="this.parentElement.parentElement.remove()">ğŸ—‘ï¸</button></td>
      `;
      tbody.appendChild(row);
    }

    function calculateProfit() {
      let totalCost = 0;
      const rows = document.querySelectorAll("#itemsBody tr");

      rows.forEach(row => {
        const cells = row.querySelectorAll("input");
        const batchPrice = parseFloat(cells[1].value);
        const batchQty = parseFloat(cells[2].value);
        const usedPerKit = parseFloat(cells[3].value);

        if (isNaN(batchPrice) || isNaN(batchQty) || isNaN(usedPerKit) || batchQty === 0) return;

        const unitPrice = batchPrice / batchQty;
        const costPerKit = unitPrice * usedPerKit;
        row.querySelector(".costPerKit").textContent = costPerKit.toFixed(2);
        totalCost += costPerKit;
      });

      const sellPrice = parseFloat(document.getElementById("sellPrice").value);
      const productionCount = parseInt(document.getElementById("productionCount").value);
      if (isNaN(sellPrice) || isNaN(productionCount)) return;

      const profit = sellPrice - totalCost;
      const marginOnCost = (profit / totalCost) * 100;
      const marginOnSell = (profit / sellPrice) * 100;
      const halfProfit = profit * 0.5;
      const totalProfit = profit * productionCount;

      lastResults = {
        totalCost: totalCost.toFixed(2),
        profit: profit.toFixed(2),
        marginOnCost: marginOnCost.toFixed(2),
        marginOnSell: marginOnSell.toFixed(2),
        halfProfit: halfProfit.toFixed(2),
        totalProfit: totalProfit.toFixed(2),
        productionCount
      };

      document.getElementById("results").innerHTML = `
        <strong>Î£ÏÎ½Î¿Î»Î¿ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:</strong> â‚¬${lastResults.totalCost}<br>
        <strong>ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:</strong> â‚¬${lastResults.profit}<br>
        <strong>Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚:</strong> ${lastResults.marginOnCost}%<br>
        <strong>Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ Î ÏÎ»Î·ÏƒÎ·Ï‚:</strong> ${lastResults.marginOnSell}%<br>
        <strong>Î¤Î¿ 50% Ï„Î¿Ï… ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:</strong> â‚¬${lastResults.halfProfit}<br>
        <strong>Î£ÏÎ½Î¿Î»Î¿ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ (${productionCount} ÎºÎ¹Ï„):</strong> â‚¬${lastResults.totalProfit}
      `;
    }

    // CSV EXPORT (Î—Î”Î— Î”ÎŸÎ¥Î›Î•Î¥Î•Î™ Î£Î©Î£Î¤Î‘)
    function exportData() {
      let csv = '\uFEFF';
      csv += 'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®,Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚,Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚,Î§ÏÎ®ÏƒÎ· Î‘Î½Î¬ ÎšÎ¹Ï„,ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„\n';
      
      const rows = document.querySelectorAll("#itemsBody tr");
      rows.forEach(row => {
        const cells = row.querySelectorAll("input");
        const description = cells[0].value;
        const batchPrice = cells[1].value;
        const batchQty = cells[2].value;
        const usedPerKit = cells[3].value;
        const costPerKit = row.querySelector(".costPerKit").textContent;
        
        csv += `"${description}","${batchPrice}","${batchQty}","${usedPerKit}","${costPerKit}"\n`;
      });

      csv += '\n"Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ­ÏÎ´Î¿Ï…Ï‚"\n';
      csv += `"Î£ÏÎ½Î¿Î»Î¿ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:","â‚¬${lastResults.totalCost}"\n`;
      csv += `"ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:","â‚¬${lastResults.profit}"\n`;
      csv += `"Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚:","${lastResults.marginOnCost}%"\n`;
      csv += `"Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ Î ÏÎ»Î·ÏƒÎ·Ï‚:","${lastResults.marginOnSell}%"\n`;
      csv += `"Î¤Î¿ 50% Ï„Î¿Ï… ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:","â‚¬${lastResults.halfProfit}"\n`;
      csv += `"Î£ÏÎ½Î¿Î»Î¿ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ (${lastResults.productionCount} ÎºÎ¹Ï„):","â‚¬${lastResults.totalProfit}"\n`;

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.setAttribute("href", URL.createObjectURL(blob));
      link.setAttribute("download", "profit-analysis.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎŸ PDF EXPORT - ÎœÎ• Î›Î‘Î¤Î™ÎÎ™ÎšÎŸÎ¥Î£ Î§Î‘Î¡Î‘ÎšÎ¤Î—Î¡Î•Î£
    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      let y = 20;
      
      // Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Î»Î±Ï„Î¹Î½Î¹ÎºÎ¿ÏÏ‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÏÎ³Î¿Ï…Î¼Îµ Ï„Î± "ÎºÎ¹Î½Î­Î¶Î¹ÎºÎ±"
      doc.setFontSize(16);
      doc.text("ANALISI KERDOUS KIT", 10, y);
      y += 15;

      doc.setFontSize(12);
      doc.text("Leptomereies Eidon:", 10, y);
      y += 10;

      const rows = document.querySelectorAll("#itemsBody tr");
      rows.forEach((row, i) => {
        const cells = row.querySelectorAll("input");
        const description = cells[0].value;
        const batchPrice = cells[1].value;
        const batchQty = cells[2].value;
        const usedPerKit = cells[3].value;
        const costPerKit = row.querySelector(".costPerKit").textContent;

        doc.setFontSize(10);
        // ÎœÎµÏ„Î±Ï„ÏÎ­Ï€Î¿Ï…Î¼Îµ Ï„Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬ ÏƒÎµ Î»Î±Ï„Î¹Î½Î¹ÎºÎ¬ Î³Î¹Î± Ï„Î¿ PDF
        const greekToLatin = (text) => {
          return text.replace(/[Î±Î¬Î‘Î†]/g, 'a')
                    .replace(/[Î²Î’]/g, 'b')
                    .replace(/[Î³Î“]/g, 'g')
                    .replace(/[Î´Î”]/g, 'd')
                    .replace(/[ÎµÎ­Î•Îˆ]/g, 'e')
                    .replace(/[Î¶Î–]/g, 'z')
                    .replace(/[Î·Î®Î—Î‰]/g, 'i')
                    .replace(/[Î¸Î˜]/g, 'th')
                    .replace(/[Î¹Î¯Î™ÎŠ]/g, 'i')
                    .replace(/[ÎºÎš]/g, 'k')
                    .replace(/[Î»Î›]/g, 'l')
                    .replace(/[Î¼Îœ]/g, 'm')
                    .replace(/[Î½Î]/g, 'n')
                    .replace(/[Î¾Î]/g, 'x')
                    .replace(/[Î¿ÏŒÎŸÎŒ]/g, 'o')
                    .replace(/[Ï€Î ]/g, 'p')
                    .replace(/[ÏÎ¡]/g, 'r')
                    .replace(/[ÏƒÏ‚Î£]/g, 's')
                    .replace(/[Ï„Î¤]/g, 't')
                    .replace(/[Ï…ÏÎ¥Î]/g, 'u')
                    .replace(/[Ï†Î¦]/g, 'f')
                    .replace(/[Ï‡Î§]/g, 'ch')
                    .replace(/[ÏˆÎ¨]/g, 'ps')
                    .replace(/[Ï‰ÏÎ©Î]/g, 'o');
        };

        const latinDescription = greekToLatin(description);
        const line = `${i + 1}) ${latinDescription} | Timi: â‚¬${batchPrice} | Pos.: ${batchQty} | Chrisi: ${usedPerKit} | Kostos/Kit: â‚¬${costPerKit}`;
        doc.text(line, 10, y);
        y += 7;
        
        if (y > 270) {
          doc.addPage();
          y = 20;
        }
      });

      y += 10;
      doc.setFontSize(12);
      doc.text("Analisi Kerdous:", 10, y);
      y += 10;

      doc.setFontSize(10);
      doc.text(`Synolo Kostous Ana Kit: â‚¬${lastResults.totalCost}`, 10, y); y += 7;
      doc.text(`Katharo Kerdos Ana Kit: â‚¬${lastResults.profit}`, 10, y); y += 7;
      doc.text(`Pososto Kerdous epi Kostous: ${lastResults.marginOnCost}%`, 10, y); y += 7;
      doc.text(`Pososto Kerdous epi Polisis: ${lastResults.marginOnSell}%`, 10, y); y += 7;
      doc.text(`To 50% tou Kerdous Ana Kit: â‚¬${lastResults.halfProfit}`, 10, y); y += 7;
      doc.text(`Synolo Kerdous (${lastResults.productionCount} kit): â‚¬${lastResults.totalProfit}`, 10, y);

      doc.save("profit-analysis.pdf");
    }

    // ÎÎ•ÎŸ! EXCEL EXPORT
    function exportExcel() {
      // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± workbook
      const wb = XLSX.utils.book_new();
      
      // Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Ï„Î¿ Ï†ÏÎ»Î»Î¿ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚
      const wsData = [];
      
      // Headers
      wsData.push(['Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®', 'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)', 'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚', 'Î§ÏÎ®ÏƒÎ· Î‘Î½Î¬ ÎšÎ¹Ï„', 'ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„ (â‚¬)']);
      
      // Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€ÏŒ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ±
      const rows = document.querySelectorAll("#itemsBody tr");
      rows.forEach(row => {
        const cells = row.querySelectorAll("input");
        const description = cells[0].value;
        const batchPrice = parseFloat(cells[1].value) || 0;
        const batchQty = parseFloat(cells[2].value) || 0;
        const usedPerKit = parseFloat(cells[3].value) || 0;
        const costPerKit = parseFloat(row.querySelector(".costPerKit").textContent) || 0;
        
        wsData.push([description, batchPrice, batchQty, usedPerKit, costPerKit]);
      });
      
      // ÎšÎµÎ½Î® Î³ÏÎ±Î¼Î¼Î®
      wsData.push([]);
      
      // Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎºÎ­ÏÎ´Î¿Ï…Ï‚
      wsData.push(['Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ­ÏÎ´Î¿Ï…Ï‚']);
      wsData.push(['Î£ÏÎ½Î¿Î»Î¿ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:', `â‚¬${lastResults.totalCost}`]);
      wsData.push(['ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:', `â‚¬${lastResults.profit}`]);
      wsData.push(['Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚:', `${lastResults.marginOnCost}%`]);
      wsData.push(['Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ Î ÏÎ»Î·ÏƒÎ·Ï‚:', `${lastResults.marginOnSell}%`]);
      wsData.push(['Î¤Î¿ 50% Ï„Î¿Ï… ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„:', `â‚¬${lastResults.halfProfit}`]);
      wsData.push([`Î£ÏÎ½Î¿Î»Î¿ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ (${lastResults.productionCount} ÎºÎ¹Ï„):`, `â‚¬${lastResults.totalProfit}`]);
      
      // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± worksheet
      const ws = XLSX.utils.aoa_to_sheet(wsData);
      
      // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¿Ï… worksheet ÏƒÏ„Î¿ workbook
      XLSX.utils.book_append_sheet(wb, ws, "Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ­ÏÎ´Î¿Ï…Ï‚");
      
      // Î•Î¾Î±Î³Ï‰Î³Î® Î±ÏÏ‡ÎµÎ¯Î¿Ï…
      XLSX.writeFile(wb, "profit-analysis.xlsx");
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }
  </script>
</body>
</html>
