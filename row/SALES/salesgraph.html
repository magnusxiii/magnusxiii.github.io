<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„ - Î ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½Î· Î‘Î½Î¬Î»Ï…ÏƒÎ·</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent-color: #00d4ff;
            --success-color: #00ff88;
            --warning-color: #ffaa00;
            --danger-color: #ff4444;
            --border-color: #444444;
            --shadow: 0 8px 32px rgba(0, 212, 255, 0.1);
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        body.light-mode {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px 0;
            border-bottom: 2px solid var(--border-color);
        }

        h1 {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .theme-btn {
            background: var(--bg-card);
            border: 2px solid var(--accent-color);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .main-content {
            display: grid;
            gap: 30px;
        }

        section {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ingredient-form, .cost-form, .sales-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        input {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .add-btn, .calculate-btn {
            background: var(--gradient);
            border: none;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-btn:hover, .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .ingredients-list, .costs-list {
            display: grid;
            gap: 10px;
        }

        .ingredient-item, .cost-item {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .remove-btn {
            background: var(--danger-color);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .result-card {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .result-card.profit {
            border-color: var(--success-color);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.05));
        }

        .result-card.total {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 212, 255, 0.05));
        }

        .result-card.warning {
            border-color: var(--warning-color);
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.1), rgba(255, 170, 0, 0.05));
        }

        .result-card h3 {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .result-card span {
            color: var(--text-primary);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
        }

        .chart-wrapper {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            height: 450px;
        }

        .chart-wrapper.large {
            grid-column: span 2;
            height: 500px;
        }

        .analysis-section {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            margin-top: 20px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analysis-item {
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
        }

        .export-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-btn.csv {
            background: var(--success-color);
            color: white;
        }

        .export-btn.pdf {
            background: var(--danger-color);
            color: white;
        }

        .export-btn.excel {
            background: var(--warning-color);
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        #resultsSection {
            display: none;
        }

        .scenario-analysis {
            margin-top: 20px;
        }

        .scenario-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .scenario-btn {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 2px solid var(--accent-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-btn:hover, .scenario-btn.active {
            background: var(--accent-color);
            color: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .ingredient-form, .cost-form, .sales-form {
                grid-template-columns: 1fr;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .chart-wrapper.large {
                grid-column: span 1;
            }
            
            .export-buttons {
                flex-direction: column;
            }
        }
        .export-btn.excel-charts {
    background: #2e7d32;
    color: white;
}

.export-btn.pdf-charts {
    background: #d32f2f;
    color: white;
}

.export-btn.excel-charts:hover,
.export-btn.pdf-charts:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ’° Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„ - Î ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½Î· Î‘Î½Î¬Î»Ï…ÏƒÎ·</h1>
            <button id="themeToggle" class="theme-btn">ğŸŒ™ Light Mode</button>
        </header>

        <div class="main-content">
            <!-- Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½ -->
            <section class="input-section">
                <h2>ğŸ“¦ Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ ÎšÎ¹Ï„</h2>
                <div class="ingredient-form">
                    <input type="text" id="description" placeholder="Î ÎµÏÎ¹Î³ÏÎ±Ï†Î® ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÎ¿Ï">
                    <input type="number" id="batchPrice" placeholder="Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)" step="0.01">
                    <input type="number" id="quantity" placeholder="Î Î¿ÏƒÏŒÏ„Î·Ï„Î± ÏƒÏ„Î·Î½ Ï€Î±ÏÏ„Î¯Î´Î±" step="0.01">
                    <input type="number" id="usage" placeholder="Î§ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ ÎšÎ¹Ï„" step="0.01">
                    <button id="addIngredient" class="add-btn">â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·</button>
                </div>
                
                <div class="ingredients-list" id="ingredientsList"></div>
            </section>

            <!-- Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎšÏŒÏƒÏ„Î· -->
            <section class="additional-costs">
                <h2>ğŸ’¸ Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎšÏŒÏƒÏ„Î·</h2>
                <div class="cost-form">
                    <input type="text" id="additionalDesc" placeholder="Î ÎµÏÎ¹Î³ÏÎ±Ï†Î® ÎºÏŒÏƒÏ„Î¿Ï…Ï‚">
                    <input type="number" id="additionalCost" placeholder="ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)" step="0.01">
                    <button id="addCost" class="add-btn">â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·</button>
                </div>
                <div class="costs-list" id="costsList"></div>
            </section>

            <!-- Î Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ -->
            <section class="sales-section">
                <h2>ğŸ’µ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î ÏÎ»Î·ÏƒÎ·Ï‚</h2>
                <div class="sales-form">
                    <input type="number" id="salePrice" placeholder="Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ ÎšÎ¹Ï„ (â‚¬)" step="0.01">
                    <input type="number" id="batchCount" placeholder="Î Î»Î®Î¸Î¿Ï‚ Î Î±ÏÏ„Î¯Î´Î±Ï‚" step="1" value="1">
                    <button id="calculate" class="calculate-btn">ğŸ§® Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚</button>
                </div>
            </section>

            <!-- Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± -->
            <section class="results-section" id="resultsSection">
                <h2>ğŸ“Š Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±</h2>
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Î£ÏÎ½Î¿Î»Î¿ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„</h3>
                        <span id="totalCost">0.00 â‚¬</span>
                    </div>
                    <div class="result-card">
                        <h3>Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„</h3>
                        <span id="salePriceResult">0.00 â‚¬</span>
                    </div>
                    <div class="result-card profit">
                        <h3>ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„</h3>
                        <span id="netProfit">0.00 â‚¬</span>
                    </div>
                    <div class="result-card">
                        <h3>Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚</h3>
                        <span id="profitOnCost">0.00%</span>
                    </div>
                    <div class="result-card">
                        <h3>Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ Î ÏÎ»Î·ÏƒÎ·Ï‚</h3>
                        <span id="profitOnSale">0.00%</span>
                    </div>
                    <div class="result-card">
                        <h3>50% Ï„Î¿Ï… ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„</h3>
                        <span id="halfProfit">0.00 â‚¬</span>
                    </div>
                    <div class="result-card total">
                        <h3>Î£ÏÎ½Î¿Î»Î¿ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ (Î Î±ÏÏ„Î¯Î´Î±)</h3>
                        <span id="totalProfit">0.00 â‚¬</span>
                    </div>
                    <div class="result-card warning">
                        <h3>Î£Î·Î¼ÎµÎ¯Î¿ Î™ÏƒÎ¿ÏƒÎºÎ­Î»Î¹ÏƒÎ·Ï‚</h3>
                        <span id="breakEven">0.00 â‚¬</span>
                    </div>
                    <div class="result-card">
                        <h3>ROI (Return on Investment)</h3>
                        <span id="roi">0.00%</span>
                    </div>
                    <div class="result-card">
                        <h3>ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î½Î¬ ÎœÎ¿Î½Î¬Î´Î±</h3>
                        <span id="unitCost">0.00 â‚¬</span>
                    </div>
                </div>

                <!-- Î ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½Î· Î‘Î½Î¬Î»Ï…ÏƒÎ· -->
                <div class="analysis-section">
                    <h3>ğŸ” Î ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½Î· Î‘Î½Î¬Î»Ï…ÏƒÎ·</h3>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <h4>ğŸ’¡ Î£Ï…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚</h4>
                            <p id="pricingRecommendation">Î¥Ï€Î¿Î»Î¿Î³Î¯ÏƒÏ„Îµ Ï€ÏÏÏ„Î± Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ ÏƒÏ…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚</p>
                        </div>
                        <div class="analysis-item">
                            <h4>âš ï¸ Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ¹Î½Î´ÏÎ½Î¿Ï…</h4>
                            <p id="riskAnalysis">Î¥Ï€Î¿Î»Î¿Î³Î¯ÏƒÏ„Îµ Ï€ÏÏÏ„Î± Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î±Î½Î¬Î»Ï…ÏƒÎ· ÎºÎ¹Î½Î´ÏÎ½Î¿Ï…</p>
                        </div>
                        <div class="analysis-item">
                            <h4>ğŸ“ˆ Î”Ï…Î½Î±Î¼Î¹ÎºÏŒ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚</h4>
                            <p id="improvementPotential">Î¥Ï€Î¿Î»Î¿Î³Î¯ÏƒÏ„Îµ Ï€ÏÏÏ„Î± Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î´Ï…Î½Î±Î¼Î¹ÎºÏŒ Î²ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚</p>
                        </div>
                        <div class="analysis-item">
                            <h4>ğŸ¯ Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒÏ„Î·Ï„Î±</h4>
                            <p id="competitiveness">Î¥Ï€Î¿Î»Î¿Î³Î¯ÏƒÏ„Îµ Ï€ÏÏÏ„Î± Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î±Î½Î¬Î»Ï…ÏƒÎ· Î±Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î± -->
            <section class="charts-section">
                <h2>ğŸ“ˆ Î ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½Î· Î‘Î½Î¬Î»Ï…ÏƒÎ· Î“ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½</h2>
                
                <!-- Î£ÎµÎ½Î¬ÏÎ¹Î± Î‘Î½Î¬Î»Ï…ÏƒÎ·Ï‚ -->
                <div class="scenario-analysis">
                    <h3>ğŸ² Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£ÎµÎ½Î±ÏÎ¯Ï‰Î½</h3>
                    <div class="scenario-controls">
                        <button class="scenario-btn active" data-scenario="current">Î¤ÏÎ­Ï‡Î¿Î½ Î£ÎµÎ½Î¬ÏÎ¹Î¿</button>
                        <button class="scenario-btn" data-scenario="optimistic">Î‘Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ (+20%)</button>
                        <button class="scenario-btn" data-scenario="pessimistic">Î‘Ï€Î±Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ (-20%)</button>
                        <button class="scenario-btn" data-scenario="competitive">Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒ (-10%)</button>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-wrapper">
                        <canvas id="pieChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="barChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="lineChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="doughnutChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="scatterChart"></canvas>
                    </div>
                    <div class="chart-wrapper large">
                        <canvas id="combinedChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="waterfallChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="sensitivityChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Î•Î¾Î±Î³Ï‰Î³Î® Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ -->
          <!-- Î•Î½Î·Î¼ÎµÏÏÏƒÏ„Îµ Ï„Î¿ export section -->
<section class="export-section">
    <h2>ğŸ“¤ Î•Î¾Î±Î³Ï‰Î³Î® Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</h2>
    <div class="export-buttons">
        <button id="exportCSV" class="export-btn csv">ğŸ“„ Î•Î¾Î±Î³Ï‰Î³Î® CSV</button>
        <button id="exportPDF" class="export-btn pdf">ğŸ“‹ Î•Î¾Î±Î³Ï‰Î³Î® PDF</button>
        <button id="exportExcel" class="export-btn excel">ğŸ“Š Î•Î¾Î±Î³Ï‰Î³Î® Excel</button>
        <button id="exportExcelCharts" class="export-btn excel-charts">ğŸ“Š Excel Î¼Îµ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î±</button>
        <button id="exportPDFCharts" class="export-btn pdf-charts">ğŸ“‹ PDF Î¼Îµ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î±</button>
    </div>
</section>

        </div>
    </div>

    <script>
        class ProfitCalculator {
            constructor() {
                this.ingredients = [];
                this.additionalCosts = [];
                this.charts = {};
                this.currentScenario = 'current';
                this.calculationResults = null;
                this.initializeEventListeners();
                this.initializeCharts();
            }

            initializeEventListeners() {
                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
                
                // Add ingredient
                document.getElementById('addIngredient').addEventListener('click', () => this.addIngredient());
                
                // Add additional cost
                document.getElementById('addCost').addEventListener('click', () => this.addAdditionalCost());
                
                // Calculate
                document.getElementById('calculate').addEventListener('click', () => this.calculate());
                
                // Export functions
                document.getElementById('exportCSV').addEventListener('click', () => this.exportCSV());
                document.getElementById('exportPDF').addEventListener('click', () => this.exportPDF());
                document.getElementById('exportExcel').addEventListener('click', () => this.exportExcel());
                
                // Scenario buttons
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.changeScenario(e.target.dataset.scenario));
                });
                
                // Enter key support
                document.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const activeElement = document.activeElement;
                        if (activeElement.closest('.ingredient-form')) {
                            this.addIngredient();
                        } else if (activeElement.closest('.cost-form')) {
                            this.addAdditionalCost();
                        } else if (activeElement.closest('.sales-form')) {
                            this.calculate();
                        }
                    }
                });
                // Î£Ï„Î·Î½ initializeEventListeners Î¼Î­Î¸Î¿Î´Î¿, Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Ï„Î¹Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚:
document.getElementById('exportExcelCharts').addEventListener('click', () => this.exportExcelWithCharts());
document.getElementById('exportPDFCharts').addEventListener('click', () => this.exportPDFWithCharts());

            }

            toggleTheme() {
                document.body.classList.toggle('light-mode');
                const themeBtn = document.getElementById('themeToggle');
                const isLight = document.body.classList.contains('light-mode');
                themeBtn.textContent = isLight ? 'ğŸŒ™ Dark Mode' : 'â˜€ï¸ Light Mode';
                
                // Update chart colors
                this.updateChartTheme();
            }

            updateChartTheme() {
                const textColor = document.body.classList.contains('light-mode') ? '#2d3748' : '#ffffff';
                const gridColor = document.body.classList.contains('light-mode') ? '#e2e8f0' : '#444444';
                
                Object.values(this.charts).forEach(chart => {
                    if (chart.options.plugins && chart.options.plugins.title) {
                        chart.options.plugins.title.color = textColor;
                    }
                    if (chart.options.plugins && chart.options.plugins.legend) {
                        chart.options.plugins.legend.labels.color = textColor;
                    }
                    if (chart.options.scales) {
                        Object.values(chart.options.scales).forEach(scale => {
                            if (scale.ticks) scale.ticks.color = textColor;
                            if (scale.grid) scale.grid.color = gridColor;
                        });
                    }
                    chart.update();
                });
            }

            addIngredient() {
                const description = document.getElementById('description').value.trim();
                const batchPrice = parseFloat(document.getElementById('batchPrice').value);
                const quantity = parseFloat(document.getElementById('quantity').value);
                const usage = parseFloat(document.getElementById('usage').value);

                if (!description || isNaN(batchPrice) || isNaN(quantity) || isNaN(usage) || batchPrice <= 0 || quantity <= 0 || usage <= 0) {
                    alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î± Î¼Îµ Î­Î³ÎºÏ…ÏÎµÏ‚ Ï„Î¹Î¼Î­Ï‚!');
                    return;
                }

                // Î‘ÎºÏÎ¹Î²ÎµÎ¯Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯ Î¼Îµ ÏƒÏ„ÏÎ¿Î³Î³Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ·
                const costPerUnit = Math.round((batchPrice / quantity) * 10000) / 10000; // 4 Î´ÎµÎºÎ±Î´Î¹ÎºÎ¬
                const totalCost = Math.round((costPerUnit * usage) * 100) / 100; // 2 Î´ÎµÎºÎ±Î´Î¹ÎºÎ¬

                const ingredient = {
                    id: Date.now(),
                    description,
                    batchPrice: Math.round(batchPrice * 100) / 100,
                    quantity: Math.round(quantity * 100) / 100,
                    usage: Math.round(usage * 100) / 100,
                    costPerUnit,
                    totalCost
                };

                this.ingredients.push(ingredient);
                this.renderIngredients();
                this.clearIngredientForm();
            }

            addAdditionalCost() {
                const description = document.getElementById('additionalDesc').value.trim();
                const cost = parseFloat(document.getElementById('additionalCost').value);

                if (!description || isNaN(cost) || cost <= 0) {
                    alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î± Î¼Îµ Î­Î³ÎºÏ…ÏÎµÏ‚ Ï„Î¹Î¼Î­Ï‚!');
                    return;
                }

                const additionalCost = {
                    id: Date.now(),
                    description,
                    cost: Math.round(cost * 100) / 100
                };

                this.additionalCosts.push(additionalCost);
                this.renderAdditionalCosts();
                this.clearCostForm();
            }

            renderIngredients() {
                const container = document.getElementById('ingredientsList');
                container.innerHTML = this.ingredients.map(ingredient => `
                    <div class="ingredient-item">
                        <div>
                            <strong>${ingredient.description}</strong><br>
                            <small>Î¤Î¹Î¼Î® Ï€Î±ÏÏ„Î¯Î´Î±Ï‚: ${ingredient.batchPrice.toFixed(2)}â‚¬ | 
                            Î Î¿ÏƒÏŒÏ„Î·Ï„Î±: ${ingredient.quantity} | 
                            Î§ÏÎ®ÏƒÎ·: ${ingredient.usage} | 
                            ÎšÏŒÏƒÏ„Î¿Ï‚/Î¼Î¿Î½Î¬Î´Î±: ${ingredient.costPerUnit.toFixed(4)}â‚¬ |
                            Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚: ${ingredient.totalCost.toFixed(2)}â‚¬</small>
                        </div>
                        <button class="remove-btn" onclick="calculator.removeIngredient(${ingredient.id})">ğŸ—‘ï¸</button>
                    </div>
                `).join('');
            }

            renderAdditionalCosts() {
                const container = document.getElementById('costsList');
                container.innerHTML = this.additionalCosts.map(cost => `
                    <div class="cost-item">
                        <div>
                            <strong>${cost.description}</strong><br>
                            <small>ÎšÏŒÏƒÏ„Î¿Ï‚: ${cost.cost.toFixed(2)}â‚¬</small>
                        </div>
                        <button class="remove-btn" onclick="calculator.removeAdditionalCost(${cost.id})">ğŸ—‘ï¸</button>
                    </div>
                `).join('');
            }

            removeIngredient(id) {
                this.ingredients = this.ingredients.filter(ingredient => ingredient.id !== id);
                this.renderIngredients();
            }

            removeAdditionalCost(id) {
                this.additionalCosts = this.additionalCosts.filter(cost => cost.id !== id);
                this.renderAdditionalCosts();
            }

            clearIngredientForm() {
                document.getElementById('description').value = '';
                document.getElementById('batchPrice').value = '';
                document.getElementById('quantity').value = '';
                document.getElementById('usage').value = '';
            }

            clearCostForm() {
                document.getElementById('additionalDesc').value = '';
                document.getElementById('additionalCost').value = '';
            }

            calculate() {
                const salePrice = parseFloat(document.getElementById('salePrice').value);
                const batchCount = parseInt(document.getElementById('batchCount').value) || 1;

                if (isNaN(salePrice) || salePrice <= 0) {
                    alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î­Î³ÎºÏ…ÏÎ· Ï„Î¹Î¼Î® Ï€ÏÎ»Î·ÏƒÎ·Ï‚!');
                    return;
                }

                // Î‘ÎºÏÎ¹Î²ÎµÎ¯Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯ Î¼Îµ ÏƒÏ‰ÏƒÏ„Î® ÏƒÏ„ÏÎ¿Î³Î³Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ·
                const ingredientsCost = this.ingredients.reduce((sum, ingredient) => sum + ingredient.totalCost, 0);
                const additionalCostTotal = this.additionalCosts.reduce((sum, cost) => sum + cost.cost, 0);
                const totalCost = Math.round((ingredientsCost + additionalCostTotal) * 100) / 100;
                const netProfit = Math.round((salePrice - totalCost) * 100) / 100;
                const profitOnCost = totalCost > 0 ? Math.round((netProfit / totalCost) * 10000) / 100 : 0;
                const profitOnSale = salePrice > 0 ? Math.round((netProfit / salePrice) * 10000) / 100 : 0;
                const halfProfit = Math.round((netProfit / 2) * 100) / 100;
                const totalProfitBatch = Math.round((netProfit * batchCount) * 100) / 100;
                
                // Î•Ï€Î¹Ï€Î»Î­Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯
                const breakEven = Math.round(totalCost * 100) / 100; // Î£Î·Î¼ÎµÎ¯Î¿ Î¹ÏƒÎ¿ÏƒÎºÎ­Î»Î¹ÏƒÎ·Ï‚
                const roi = totalCost > 0 ? Math.round((netProfit / totalCost) * 10000) / 100 : 0; // ROI
                const unitCost = Math.round(totalCost * 100) / 100; // ÎšÏŒÏƒÏ„Î¿Ï‚ Î±Î½Î¬ Î¼Î¿Î½Î¬Î´Î±

                // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
                this.calculationResults = {
                    salePrice,
                    batchCount,
                    ingredientsCost,
                    additionalCostTotal,
                    totalCost,
                    netProfit,
                    profitOnCost,
                    profitOnSale,
                    halfProfit,
                    totalProfitBatch,
                    breakEven,
                    roi,
                    unitCost
                };

                // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· UI
                this.updateResults();
                this.updateAnalysis();
                this.updateAllCharts();

                // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
                document.getElementById('resultsSection').style.display = 'block';
            }

            updateResults() {
                const results = this.calculationResults;
                
                document.getElementById('totalCost').textContent = `${results.totalCost.toFixed(2)} â‚¬`;
                document.getElementById('salePriceResult').textContent = `${results.salePrice.toFixed(2)} â‚¬`;
                document.getElementById('netProfit').textContent = `${results.netProfit.toFixed(2)} â‚¬`;
                document.getElementById('profitOnCost').textContent = `${results.profitOnCost.toFixed(2)}%`;
                document.getElementById('profitOnSale').textContent = `${results.profitOnSale.toFixed(2)}%`;
                document.getElementById('halfProfit').textContent = `${results.halfProfit.toFixed(2)} â‚¬`;
                document.getElementById('totalProfit').textContent = `${results.totalProfitBatch.toFixed(2)} â‚¬`;
                document.getElementById('breakEven').textContent = `${results.breakEven.toFixed(2)} â‚¬`;
                document.getElementById('roi').textContent = `${results.roi.toFixed(2)}%`;
                document.getElementById('unitCost').textContent = `${results.unitCost.toFixed(2)} â‚¬`;
            }

            updateAnalysis() {
                const results = this.calculationResults;
                
                // Î£Ï…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚
                let pricingText = '';
                if (results.profitOnCost < 20) {
                    pricingText = 'âš ï¸ Î§Î±Î¼Î·Î»ÏŒ Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î¿ ÎºÎ­ÏÎ´Î¿Ï…Ï‚. Î£Ï…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î±ÏÎ¾Î·ÏƒÎ· Ï„Î¹Î¼Î®Ï‚ Î® Î¼ÎµÎ¯Ï‰ÏƒÎ· ÎºÏŒÏƒÏ„Î¿Ï…Ï‚.';
                } else if (results.profitOnCost > 50) {
                    pricingText = 'âœ… Î•Î¾Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î¿ ÎºÎ­ÏÎ´Î¿Ï…Ï‚. Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÎ® Î¸Î­ÏƒÎ·.';
                } else {
                    pricingText = 'âœ… Î¥Î³Î¹Î­Ï‚ Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î¿ ÎºÎ­ÏÎ´Î¿Ï…Ï‚. ÎšÎ±Î»Î® Î¹ÏƒÎ¿ÏÏÎ¿Ï€Î¯Î± Ï„Î¹Î¼Î®Ï‚-ÎºÏŒÏƒÏ„Î¿Ï…Ï‚.';
                }
                document.getElementById('pricingRecommendation').textContent = pricingText;

                // Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ¹Î½Î´ÏÎ½Î¿Ï…
                let riskText = '';
                const riskScore = results.profitOnCost;
                if (riskScore < 10) {
                    riskText = 'ğŸ”´ Î¥ÏˆÎ·Î»ÏŒÏ‚ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚. ÎœÎ¹ÎºÏÏŒ Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î¿ Î³Î¹Î± Î±Ï…Î¾Î®ÏƒÎµÎ¹Ï‚ ÎºÏŒÏƒÏ„Î¿Ï…Ï‚.';
                } else if (riskScore < 30) {
                    riskText = 'ğŸŸ¡ ÎœÎ­Ï„ÏÎ¹Î¿Ï‚ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚. Î ÏÎ¿ÏƒÎ¿Ï‡Î® ÏƒÎµ Î±Ï…Î¾Î®ÏƒÎµÎ¹Ï‚ ÎºÏŒÏƒÏ„Î¿Ï…Ï‚.';
                } else {
                    riskText = 'ğŸŸ¢ Î§Î±Î¼Î·Î»ÏŒÏ‚ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚. ÎšÎ±Î»ÏŒ Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î¿ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.';
                }
                document.getElementById('riskAnalysis').textContent = riskText;

                // Î”Ï…Î½Î±Î¼Î¹ÎºÏŒ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚
                const mostExpensive = this.ingredients.reduce((max, ingredient) => 
                    ingredient.totalCost > max.totalCost ? ingredient : max, 
                    this.ingredients[0] || { description: 'ÎšÎ±Î½Î­Î½Î±', totalCost: 0 }
                );
                const improvementText = `ğŸ¯ ÎœÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ ÎºÏŒÏƒÏ„Î¿Ï‚: ${mostExpensive.description} (${mostExpensive.totalCost.toFixed(2)}â‚¬). Î•ÏƒÏ„Î¹Î¬ÏƒÏ„Îµ ÎµÎ´Ï Î³Î¹Î± Î¼ÎµÎ¯Ï‰ÏƒÎ· ÎºÏŒÏƒÏ„Î¿Ï…Ï‚.`;
                document.getElementById('improvementPotential').textContent = improvementText;

                // Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒÏ„Î·Ï„Î±
                let competitivenessText = '';
                if (results.profitOnSale > 25) {
                    competitivenessText = 'ğŸ’ª Î Î¿Î»Ï Î±Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒ Ï€ÏÎ¿ÏŠÏŒÎ½ Î¼Îµ Ï…ÏˆÎ·Î»Î® ÎºÎµÏÎ´Î¿Ï†Î¿ÏÎ¯Î±.';
                } else if (results.profitOnSale > 15) {
                    competitivenessText = 'ğŸ‘ Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒ Ï€ÏÎ¿ÏŠÏŒÎ½ Î¼Îµ ÎºÎ±Î»Î® ÎºÎµÏÎ´Î¿Ï†Î¿ÏÎ¯Î±.';
                } else {
                    competitivenessText = 'âš¡ Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î²ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· Î³Î¹Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ· Î±Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒÏ„Î·Ï„Î±.';
                }
                document.getElementById('competitiveness').textContent = competitivenessText;
            }

            changeScenario(scenario) {
                this.currentScenario = scenario;
                
                // Update active button
                document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-scenario="${scenario}"]`).classList.add('active');
                
                // Update charts with scenario
                if (this.calculationResults) {
                    this.updateAllCharts();
                }
            }

            getScenarioMultiplier() {
                switch (this.currentScenario) {
                    case 'optimistic': return 1.2;
                    case 'pessimistic': return 0.8;
                    case 'competitive': return 0.9;
                    default: return 1.0;
                }
            }

            initializeCharts() {
                const textColor = '#ffffff';
                const gridColor = '#444444';

                // Pie Chart - ÎšÎ±Ï„Î±Î½Î¿Î¼Î® ÎšÏŒÏƒÏ„Î¿Ï…Ï‚
                const pieCtx = document.getElementById('pieChart').getContext('2d');
                this.charts.pie = new Chart(pieCtx, {
                    type: 'pie',
                    data: {
                        labels: ['ÎšÏŒÏƒÏ„Î¿Ï‚ Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½', 'Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎšÏŒÏƒÏ„Î·', 'ÎšÎ­ÏÎ´Î¿Ï‚'],
                        datasets: [{
                            data: [1, 1, 1],
                            backgroundColor: ['#ff6384', '#36a2eb', '#4bc0c0'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'ÎšÎ±Ï„Î±Î½Î¿Î¼Î® ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ & ÎšÎ­ÏÎ´Î¿Ï…Ï‚',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: {
                                labels: { color: textColor }
                            }
                        }
                    }
                });

                // Bar Chart - Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·
                const barCtx = document.getElementById('barChart').getContext('2d');
                this.charts.bar = new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: ['ÎšÏŒÏƒÏ„Î¿Ï‚', 'Î ÏÎ»Î·ÏƒÎ·', 'ÎšÎ­ÏÎ´Î¿Ï‚'],
                        datasets: [{
                            label: 'Î Î¿ÏƒÎ¬ (â‚¬)',
                            data: [0, 0, 0],
                            backgroundColor: ['#ff6384', '#36a2eb', '#4bc0c0'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ - Î ÏÎ»Î·ÏƒÎ·Ï‚ - ÎšÎ­ÏÎ´Î¿Ï…Ï‚',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            },
                            x: {
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            }
                        }
                    }
                });

                // Line Chart - Î ÏÎ¿Î²Î¿Î»Î® ÎšÎ­ÏÎ´Î¿Ï…Ï‚
                const lineCtx = document.getElementById('lineChart').getContext('2d');
                this.charts.line = new Chart(lineCtx, {
                    type: 'line',
                    data: {
                        labels: ['ÎœÎ®Î½Î±Ï‚ 1', 'ÎœÎ®Î½Î±Ï‚ 2', 'ÎœÎ®Î½Î±Ï‚ 3', 'ÎœÎ®Î½Î±Ï‚ 4', 'ÎœÎ®Î½Î±Ï‚ 5', 'ÎœÎ®Î½Î±Ï‚ 6'],
                        datasets: [{
                            label: 'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)',
                            data: [0, 0, 0, 0, 0, 0],
                            borderColor: '#4bc0c0',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Î ÏÎ¿Î²Î¿Î»Î® ÎšÎ­ÏÎ´Î¿Ï…Ï‚ (6 ÎœÎ®Î½ÎµÏ‚)',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            },
                            x: {
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            }
                        }
                    }
                });

                // Doughnut Chart - Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½
                const doughnutCtx = document.getElementById('doughnutChart').getContext('2d');
                this.charts.doughnut = new Chart(doughnutCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏŒ 1'],
                        datasets: [{
                            data: [100],
                            backgroundColor: ['#ff9f40', '#ff6384', '#36a2eb', '#4bc0c0', '#9966ff'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: { labels: { color: textColor } }
                        }
                    }
                });

                // Radar Chart - Î‘Î½Î¬Î»Ï…ÏƒÎ· Î•Ï€Î¹Î´ÏŒÏƒÎµÏ‰Î½
                const radarCtx = document.getElementById('radarChart').getContext('2d');
                this.charts.radar = new Chart(radarCtx, {
                    type: 'radar',
                    data: {
                        labels: ['ÎšÎµÏÎ´Î¿Ï†Î¿ÏÎ¯Î±', 'Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒÏ„Î·Ï„Î±', 'Î Î¿Î¹ÏŒÏ„Î·Ï„Î±', 'ÎšÏŒÏƒÏ„Î¿Ï‚', 'ROI'],
                        datasets: [{
                            label: 'Î•Ï€Î¯Î´Î¿ÏƒÎ· Î ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚',
                            data: [50, 50, 50, 50, 50],
                            borderColor: '#4bc0c0',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            pointBackgroundColor: '#4bc0c0'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Î‘Î½Î¬Î»Ï…ÏƒÎ· Î•Ï€Î¹Î´ÏŒÏƒÎµÏ‰Î½ Î ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { color: textColor },
                                grid: { color: gridColor },
                                pointLabels: { color: textColor }
                            }
                        }
                    }
                });

                // Scatter Chart - Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ vs ÎšÎ­ÏÎ´Î¿Ï…Ï‚
                const scatterCtx = document.getElementById('scatterChart').getContext('2d');
                this.charts.scatter = new Chart(scatterCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'ÎšÏŒÏƒÏ„Î¿Ï‚ vs ÎšÎ­ÏÎ´Î¿Ï‚',
                            data: [{x: 0, y: 0}],
                            backgroundColor: '#ff6384',
                            borderColor: '#ff6384'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ vs ÎšÎ­ÏÎ´Î¿Ï…Ï‚',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)',
                                    color: textColor
                                },
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)',
                                    color: textColor
                                },
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            }
                        }
                    }
                });

                // Combined Chart - Î£ÎµÎ½Î¬ÏÎ¹Î±
                const combinedCtx = document.getElementById('combinedChart').getContext('2d');
                this.charts.combined = new Chart(combinedCtx, {
                    type: 'line',
                    data: {
                        labels: ['Î¤ÏÎ­Ï‡Î¿Î½', 'Î‘Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿', 'Î‘Ï€Î±Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿', 'Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒ'],
                        datasets: [{
                            type: 'bar',
                            label: 'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)',
                            data: [0, 0, 0, 0],
                            backgroundColor: '#ff6384',
                            yAxisID: 'y'
                        }, {
                            type: 'line',
                            label: 'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)',
                            data: [0, 0, 0, 0],
                            borderColor: '#4bc0c0',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            yAxisID: 'y'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î£ÎµÎ½Î±ÏÎ¯Ï‰Î½',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                position: 'left',
                                beginAtZero: true,
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            },
                            x: {
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            }
                        }
                    }
                });

                // Waterfall Chart (simulated with bar chart)
                const waterfallCtx = document.getElementById('waterfallChart').getContext('2d');
                this.charts.waterfall = new Chart(waterfallCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Î‘ÏÏ‡Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚', 'Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬', 'Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎšÏŒÏƒÏ„Î·', 'Î¤ÎµÎ»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚'],
                        datasets: [{
                            label: 'Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                            data: [0, 0, 0, 0],
                            backgroundColor: ['#36a2eb', '#ff6384', '#ff9f40', '#4bc0c0']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Waterfall Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            },
                            x: {
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            }
                        }
                    }
                });

                // Sensitivity Chart
                const sensitivityCtx = document.getElementById('sensitivityChart').getContext('2d');
                this.charts.sensitivity = new Chart(sensitivityCtx, {
                    type: 'line',
                    data: {
                        labels: ['-20%', '-10%', '0%', '+10%', '+20%'],
                        datasets: [{
                            label: 'ÎœÎµÏ„Î±Î²Î¿Î»Î® ÎšÎ­ÏÎ´Î¿Ï…Ï‚',
                            data: [0, 0, 0, 0, 0],
                            borderColor: '#ff6384',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Î‘Î½Î¬Î»Ï…ÏƒÎ· Î•Ï…Î±Î¹ÏƒÎ¸Î·ÏƒÎ¯Î±Ï‚ Î¤Î¹Î¼Î®Ï‚',
                                color: textColor,
                                font: { size: 16 }
                            },
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)',
                                    color: textColor
                                },
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'ÎœÎµÏ„Î±Î²Î¿Î»Î® Î¤Î¹Î¼Î®Ï‚',
                                    color: textColor
                                },
                                ticks: { color: textColor },
                                grid: { color: gridColor }
                            }
                        }
                    }
                });
            }

            updateAllCharts() {
                if (!this.calculationResults) return;

                const results = this.calculationResults;
                const multiplier = this.getScenarioMultiplier();

                // Update Pie Chart
                this.charts.pie.data.datasets[0].data = [
                    results.ingredientsCost,
                    results.additionalCostTotal,
                    Math.max(results.netProfit * multiplier, 0)
                ];
                this.charts.pie.update();

                // Update Bar Chart
                this.charts.bar.data.datasets[0].data = [
                    results.totalCost,
                    results.salePrice * multiplier,
                    results.netProfit * multiplier
                ];
                this.charts.bar.update();

                // Update Line Chart
                const monthlyProfit = Array(6).fill(results.netProfit * multiplier);
                this.charts.line.data.datasets[0].data = monthlyProfit;
                this.charts.line.update();

                // Update Doughnut Chart - Ingredients breakdown
                if (this.ingredients.length > 0) {
                    this.charts.doughnut.data.labels = this.ingredients.map(ing => ing.description);
                    this.charts.doughnut.data.datasets[0].data = this.ingredients.map(ing => ing.totalCost);
                    this.charts.doughnut.update();
                }

                // Update Radar Chart
                const profitScore = Math.min(results.profitOnCost * 2, 100);
                const competitiveScore = results.profitOnSale > 20 ? 80 : results.profitOnSale * 4;
                const qualityScore = 75; // Assumed
                const costScore = results.totalCost < 10 ? 90 : Math.max(20, 100 - results.totalCost * 5);
                const roiScore = Math.min(results.roi * 2, 100);

                this.charts.radar.data.datasets[0].data = [
                    profitScore, competitiveScore, qualityScore, costScore, roiScore
                ];
                this.charts.radar.update();

                // Update Scatter Chart
                this.charts.scatter.data.datasets[0].data = [{
                    x: results.totalCost,
                    y: results.netProfit * multiplier
                }];
                this.charts.scatter.update();

                // Update Combined Chart
                this.charts.combined.data.datasets[0].data = [
                    results.totalCost,
                    results.totalCost,
                    results.totalCost,
                    results.totalCost
                ];
                this.charts.combined.data.datasets[1].data = [
                    results.netProfit,
                    results.netProfit * 1.2,
                    results.netProfit * 0.8,
                    results.netProfit * 0.9
                ];
                this.charts.combined.update();

                // Update Waterfall Chart
                this.charts.waterfall.data.datasets[0].data = [
                    0,
                    results.ingredientsCost,
                    results.additionalCostTotal,
                    results.totalCost
                ];
                this.charts.waterfall.update();

                // Update Sensitivity Chart
                const baseProfit = results.netProfit;
                const sensitivityData = [
                    baseProfit * 0.8 - results.totalCost * 0.2,
                    baseProfit * 0.9 - results.totalCost * 0.1,
                    baseProfit,
                    baseProfit * 1.1 + results.totalCost * 0.1,
                    baseProfit * 1.2 + results.totalCost * 0.2
                ];
                this.charts.sensitivity.data.datasets[0].data = sensitivityData;
                this.charts.sensitivity.update();
            }

            exportCSV() {
                const data = this.prepareExportData();
                const csv = this.convertToCSV(data);
                this.downloadFile(csv, 'profit-analysis.csv', 'text/csv;charset=utf-8;');
            }

            // Î‘Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Ï„Î·Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± exportPDF Î¼Î­Î¸Î¿Î´Î¿ Î¼Îµ Î±Ï…Ï„Î®:
exportPDF() {
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Î§ÏÎ®ÏƒÎ· font Ï€Î¿Ï… Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬
        doc.setFont('helvetica');
        doc.setFontSize(18);
        
        // ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® ÎµÎ»Î»Î·Î½Î¹ÎºÏÎ½ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÏ‰Î½ ÏƒÎµ Latin-1
        const greekToLatin = (text) => {
            const greekMap = {
                'Î‘': 'A', 'Î’': 'B', 'Î“': 'G', 'Î”': 'D', 'Î•': 'E', 'Î–': 'Z', 'Î—': 'H', 'Î˜': 'TH',
                'Î™': 'I', 'Îš': 'K', 'Î›': 'L', 'Îœ': 'M', 'Î': 'N', 'Î': 'X', 'ÎŸ': 'O', 'Î ': 'P',
                'Î¡': 'R', 'Î£': 'S', 'Î¤': 'T', 'Î¥': 'Y', 'Î¦': 'F', 'Î§': 'CH', 'Î¨': 'PS', 'Î©': 'O',
                'Î±': 'a', 'Î²': 'b', 'Î³': 'g', 'Î´': 'd', 'Îµ': 'e', 'Î¶': 'z', 'Î·': 'h', 'Î¸': 'th',
                'Î¹': 'i', 'Îº': 'k', 'Î»': 'l', 'Î¼': 'm', 'Î½': 'n', 'Î¾': 'x', 'Î¿': 'o', 'Ï€': 'p',
                'Ï': 'r', 'Ïƒ': 's', 'Ï‚': 's', 'Ï„': 't', 'Ï…': 'y', 'Ï†': 'f', 'Ï‡': 'ch', 'Ïˆ': 'ps', 'Ï‰': 'o',
                'Î¬': 'a', 'Î­': 'e', 'Î®': 'h', 'Î¯': 'i', 'ÏŒ': 'o', 'Ï': 'y', 'Ï': 'o',
                'Î†': 'A', 'Îˆ': 'E', 'Î‰': 'H', 'ÎŠ': 'I', 'ÎŒ': 'O', 'Î': 'Y', 'Î': 'O'
            };
            
            return text.replace(/[Î‘-Î©Î±-Ï‰Î¬Î­Î®Î¯ÏŒÏÏÎ†ÎˆÎ‰ÎŠÎŒÎÎ]/g, match => greekMap[match] || match);
        };
        
        // Î¤Î¯Ï„Î»Î¿Ï‚
        doc.text(greekToLatin('Ypologistis Kerdous Ana Kit'), 20, 20);
        doc.text(greekToLatin('ProchorimenÄ« Analysi'), 20, 30);
        
        let yPos = 50;
        
        // Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬
        doc.setFontSize(14);
        doc.text(greekToLatin('Systatika:'), 20, yPos);
        yPos += 10;
        
        doc.setFontSize(10);
        this.ingredients.forEach(ingredient => {
            const text = `â€¢ ${greekToLatin(ingredient.description)}: ${ingredient.totalCost.toFixed(2)} EUR`;
            doc.text(text, 25, yPos);
            yPos += 6;
        });
        
        // Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎºÏŒÏƒÏ„Î·
        yPos += 5;
        doc.setFontSize(14);
        doc.text(greekToLatin('Epipleon Kosti:'), 20, yPos);
        yPos += 10;
        
        doc.setFontSize(10);
        this.additionalCosts.forEach(cost => {
            const text = `â€¢ ${greekToLatin(cost.description)}: ${cost.cost.toFixed(2)} EUR`;
            doc.text(text, 25, yPos);
            yPos += 6;
        });
        
        // Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±
        yPos += 10;
        doc.setFontSize(14);
        doc.text(greekToLatin('Apotelesmata Analysi:'), 20, yPos);
        yPos += 10;
        
        const results = [
            `Synolo Kostous: ${document.getElementById('totalCost').textContent}`,
            `Timi Polisis: ${document.getElementById('salePriceResult').textContent}`,
            `Katharo Kerdos: ${document.getElementById('netProfit').textContent}`,
            `Pososto Kerdous epi Kostous: ${document.getElementById('profitOnCost').textContent}`,
            `Pososto Kerdous epi Polisis: ${document.getElementById('profitOnSale').textContent}`,
            `ROI: ${document.getElementById('roi').textContent}`,
            `Simeio Isoskelisis: ${document.getElementById('breakEven').textContent}`
        ];
        
        doc.setFontSize(10);
        results.forEach(result => {
            doc.text(`â€¢ ${greekToLatin(result)}`, 25, yPos);
            yPos += 6;
        });
        
        // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î³ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½
        yPos += 15;
        if (yPos > 250) {
            doc.addPage();
            yPos = 20;
        }
        
        doc.setFontSize(14);
        doc.text(greekToLatin('Grafimata:'), 20, yPos);
        yPos += 10;
        
        // Î•Î¾Î±Î³Ï‰Î³Î® Î³ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½
        const chartPromises = [];
        
        // Pie Chart
        const pieCanvas = document.getElementById('pieChart');
        if (pieCanvas) {
            const pieImgData = pieCanvas.toDataURL('image/png', 1.0);
            doc.addImage(pieImgData, 'PNG', 20, yPos, 80, 60);
            yPos += 70;
        }
        
        // Bar Chart
        if (yPos > 200) {
            doc.addPage();
            yPos = 20;
        }
        
        const barCanvas = document.getElementById('barChart');
        if (barCanvas) {
            const barImgData = barCanvas.toDataURL('image/png', 1.0);
            doc.addImage(barImgData, 'PNG', 20, yPos, 80, 60);
            yPos += 70;
        }
        
        // Line Chart
        if (yPos > 200) {
            doc.addPage();
            yPos = 20;
        }
        
        const lineCanvas = document.getElementById('lineChart');
        if (lineCanvas) {
            const lineImgData = lineCanvas.toDataURL('image/png', 1.0);
            doc.addImage(lineImgData, 'PNG', 20, yPos, 80, 60);
        }
        
        // Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±
        doc.addPage();
        doc.setFontSize(8);
        doc.text(`Dimiourgithe: ${new Date().toLocaleDateString('el-GR')}`, 20, 20);
        
        doc.save('profit-analysis-advanced.pdf');
        this.showNotification('PDF ÎµÎ¾Î®Ï‡Î¸Î· ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
        
    } catch (error) {
        console.error('PDF Export Error:', error);
        this.showNotification('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® PDF: ' + error.message, 'error');
    }
}

// ÎÎ­Î± Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± ÎµÎ¾Î±Î³Ï‰Î³Î® Excel Î¼Îµ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î±
exportExcelWithCharts() {
    try {
        const data = this.prepareExportData();
        
        // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
        if (this.calculationResults) {
            data.push({
                'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                'Î‘/Î‘': '',
                'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'Î£ÏÎ½Î¿Î»Î¿ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)': '',
                'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                'Î§ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ ÎšÎ¹Ï„': '',
                'ÎšÏŒÏƒÏ„Î¿Ï‚/ÎœÎ¿Î½Î¬Î´Î± (â‚¬)': '',
                'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': '100.00'
            });
            
            data.push({
                'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                'Î‘/Î‘': '',
                'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚',
                'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)': '',
                'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                'Î§ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ ÎšÎ¹Ï„': '',
                'ÎšÏŒÏƒÏ„Î¿Ï‚/ÎœÎ¿Î½Î¬Î´Î± (â‚¬)': '',
                'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.netProfit.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': ''
            });
            
            data.push({
                'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                'Î‘/Î‘': '',
                'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'ROI',
                'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)': '',
                'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                'Î§ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ ÎšÎ¹Ï„': '',
                'ÎšÏŒÏƒÏ„Î¿Ï‚/ÎœÎ¿Î½Î¬Î´Î± (â‚¬)': '',
                'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.roi.toFixed(2) + '%',
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': ''
            });
        }
        
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ­ÏÎ´Î¿Ï…Ï‚');
        
        // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï†ÏÎ»Î»Î¿Ï… Î¼Îµ ÏƒÎµÎ½Î¬ÏÎ¹Î±
        if (this.calculationResults) {
            const scenarioData = [
                {
                    'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î¤ÏÎ­Ï‡Î¿Î½',
                    'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ (â‚¬)': this.calculationResults.salePrice.toFixed(2),
                    'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                    'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)': this.calculationResults.netProfit.toFixed(2),
                    'ROI (%)': this.calculationResults.roi.toFixed(2),
                    'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': this.calculationResults.profitOnCost.toFixed(2)
                },
                {
                    'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î‘Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ (+20%)',
                    'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ (â‚¬)': (this.calculationResults.salePrice * 1.2).toFixed(2),
                    'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                    'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)': ((this.calculationResults.salePrice * 1.2) - this.calculationResults.totalCost).toFixed(2),
                    'ROI (%)': (((this.calculationResults.salePrice * 1.2) - this.calculationResults.totalCost) / this.calculationResults.totalCost * 100).toFixed(2),
                    'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': (((this.calculationResults.salePrice * 1.2) - this.calculationResults.totalCost) / this.calculationResults.totalCost * 100).toFixed(2)
                },
                {
                    'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î‘Ï€Î±Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ (-20%)',
                    'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ (â‚¬)': (this.calculationResults.salePrice * 0.8).toFixed(2),
                    'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                    'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)': ((this.calculationResults.salePrice * 0.8) - this.calculationResults.totalCost).toFixed(2),
                    'ROI (%)': (((this.calculationResults.salePrice * 0.8) - this.calculationResults.totalCost) / this.calculationResults.totalCost * 100).toFixed(2),
                    'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': (((this.calculationResults.salePrice * 0.8) - this.calculationResults.totalCost) / this.calculationResults.totalCost * 100).toFixed(2)
                }
            ];
            
            const scenarioWs = XLSX.utils.json_to_sheet(scenarioData);
            XLSX.utils.book_append_sheet(wb, scenarioWs, 'Î£ÎµÎ½Î¬ÏÎ¹Î±');
        }
        
        // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï†ÏÎ»Î»Î¿Ï… Î¼Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½
        const chartData = [];
        
        // Î”ÎµÎ´Î¿Î¼Î­Î½Î± Pie Chart
        if (this.calculationResults) {
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Pie Chart',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'ÎšÏŒÏƒÏ„Î¿Ï‚ Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.ingredientsCost.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ((this.calculationResults.ingredientsCost / (this.calculationResults.ingredientsCost + this.calculationResults.additionalCostTotal + Math.max(this.calculationResults.netProfit, 0))) * 100).toFixed(2)
            });
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Pie Chart',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎšÏŒÏƒÏ„Î·',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.additionalCostTotal.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ((this.calculationResults.additionalCostTotal / (this.calculationResults.ingredientsCost + this.calculationResults.additionalCostTotal + Math.max(this.calculationResults.netProfit, 0))) * 100).toFixed(2)
            });
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Pie Chart',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'ÎšÎ­ÏÎ´Î¿Ï‚',
                'Î‘Î¾Î¯Î± (â‚¬)': Math.max(this.calculationResults.netProfit, 0).toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ((Math.max(this.calculationResults.netProfit, 0) / (this.calculationResults.ingredientsCost + this.calculationResults.additionalCostTotal + Math.max(this.calculationResults.netProfit, 0))) * 100).toFixed(2)
            });
            
            // Î”ÎµÎ´Î¿Î¼Î­Î½Î± Bar Chart
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Bar Chart',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'ÎšÏŒÏƒÏ„Î¿Ï‚',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ''
            });
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Bar Chart',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'Î ÏÎ»Î·ÏƒÎ·',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.salePrice.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ''
            });
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Bar Chart',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'ÎšÎ­ÏÎ´Î¿Ï‚',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.netProfit.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ''
            });
        }
        
        const chartWs = XLSX.utils.json_to_sheet(chartData);
        XLSX.utils.book_append_sheet(wb, chartWs, 'Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î“ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½');
        
        XLSX.writeFile(wb, 'profit-analysis-with-charts.xlsx');
        this.showNotification('Excel Î¼Îµ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î± ÎµÎ¾Î®Ï‡Î¸Î· ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
        
    } catch (error) {
        console.error('Excel Export Error:', error);
        this.showNotification('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® Excel: ' + error.message, 'error');
    }
}

// Î‘Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Ï„Î·Î½ exportPDFWithCharts Î¼Î­Î¸Î¿Î´Î¿ Î¼Îµ Î±Ï…Ï„Î®:
async exportPDFWithCharts() {
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('landscape', 'mm', 'a4');
        
        const greekToLatin = (text) => {
            const greekMap = {
                'Î‘': 'A', 'Î’': 'B', 'Î“': 'G', 'Î”': 'D', 'Î•': 'E', 'Î–': 'Z', 'Î—': 'H', 'Î˜': 'TH',
                'Î™': 'I', 'Îš': 'K', 'Î›': 'L', 'Îœ': 'M', 'Î': 'N', 'Î': 'X', 'ÎŸ': 'O', 'Î ': 'P',
                'Î¡': 'R', 'Î£': 'S', 'Î¤': 'T', 'Î¥': 'Y', 'Î¦': 'F', 'Î§': 'CH', 'Î¨': 'PS', 'Î©': 'O',
                'Î±': 'a', 'Î²': 'b', 'Î³': 'g', 'Î´': 'd', 'Îµ': 'e', 'Î¶': 'z', 'Î·': 'h', 'Î¸': 'th',
                'Î¹': 'i', 'Îº': 'k', 'Î»': 'l', 'Î¼': 'm', 'Î½': 'n', 'Î¾': 'x', 'Î¿': 'o', 'Ï€': 'p',
                'Ï': 'r', 'Ïƒ': 's', 'Ï‚': 's', 'Ï„': 't', 'Ï…': 'y', 'Ï†': 'f', 'Ï‡': 'ch', 'Ïˆ': 'ps', 'Ï‰': 'o',
                'Î¬': 'a', 'Î­': 'e', 'Î®': 'h', 'Î¯': 'i', 'ÏŒ': 'o', 'Ï': 'y', 'Ï': 'o',
                'Î†': 'A', 'Îˆ': 'E', 'Î‰': 'H', 'ÎŠ': 'I', 'ÎŒ': 'O', 'Î': 'Y', 'Î': 'O'
            };
            return text.replace(/[Î‘-Î©Î±-Ï‰Î¬Î­Î®Î¯ÏŒÏÏÎ†ÎˆÎ‰ÎŠÎŒÎÎ]/g, match => greekMap[match] || match);
        };

        // Î›Î¯ÏƒÏ„Î± Î³ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½ Î¼Îµ Ï„Î¯Ï„Î»Î¿Ï…Ï‚
        const charts = [
            { id: 'pieChart', title: 'Katanomi Kostous & Kerdous' },
            { id: 'barChart', title: 'Sygkrisi Kostous - Polisis - Kerdous' },
            { id: 'lineChart', title: 'Provoli Kerdous' },
            { id: 'doughnutChart', title: 'Analysi Systatikon' },
            { id: 'radarChart', title: 'Analysi Epidoseon' },
            { id: 'combinedChart', title: 'Sygkrisi Senario' }
        ];

        // Î£ÎµÎ»Î¯Î´Î± 1: Î¤Î¯Ï„Î»Î¿Ï‚ ÎºÎ±Î¹ Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(20);
        doc.text(greekToLatin('Ypologistis Kerdous Ana Kit'), 20, 20);
        doc.text(greekToLatin('Anafora me Grafimata'), 20, 30);
        
        let yPos = 50;
        
        // Î’Î±ÏƒÎ¹ÎºÎ¬ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(12);
        
        if (this.calculationResults) {
            const results = [
                `Synolo Kostous: ${this.calculationResults.totalCost.toFixed(2)} EUR`,
                `Timi Polisis: ${this.calculationResults.salePrice.toFixed(2)} EUR`,
                `Katharo Kerdos: ${this.calculationResults.netProfit.toFixed(2)} EUR`,
                `ROI: ${this.calculationResults.roi.toFixed(2)}%`,
                `Pososto Kerdous: ${this.calculationResults.profitOnCost.toFixed(2)}%`
            ];
            
            results.forEach(result => {
                doc.text(greekToLatin(result), 20, yPos);
                yPos += 8;
            });
        }

        // Î•Î¾Î±Î³Ï‰Î³Î® ÎºÎ¬Î¸Îµ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ ÏƒÎµ Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î® ÏƒÎµÎ»Î¯Î´Î±
        for (let i = 0; i < charts.length; i++) {
            const chart = charts[i];
            const canvas = document.getElementById(chart.id);
            
            if (canvas) {
                // ÎÎ­Î± ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± ÎºÎ¬Î¸Îµ Î³ÏÎ¬Ï†Î·Î¼Î±
                doc.addPage();
                
                // Î¤Î¯Ï„Î»Î¿Ï‚ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(16);
                doc.text(greekToLatin(chart.title), 20, 20);
                
                try {
                    // Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¸ÎµÎ¯ Ï„Î¿ rendering
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ¹ÎºÏŒÎ½Î±Ï‚ Î¼Îµ Î»ÎµÏ…ÎºÏŒ background
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = canvas.width;
                    tempCanvas.height = canvas.height;
                    
                    // Î›ÎµÏ…ÎºÏŒ background
                    tempCtx.fillStyle = '#ffffff';
                    tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                    
                    // Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Ï„Î¿Ï… Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿ Î»ÎµÏ…ÎºÏŒ background
                    tempCtx.drawImage(canvas, 0, 0);
                    
                    // ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® ÏƒÎµ base64
                    const imgData = tempCanvas.toDataURL('image/png', 1.0);
                    
                    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ PDF Î¼Îµ ÏƒÏ‰ÏƒÏ„Î­Ï‚ Î´Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚
                    const imgWidth = 240; // A4 landscape width - margins
                    const imgHeight = 150; // Proportional height
                    
                    doc.addImage(imgData, 'PNG', 20, 30, imgWidth, imgHeight);
                    
                } catch (error) {
                    console.error(`Î£Ï†Î¬Î»Î¼Î± ÎµÎ¾Î±Î³Ï‰Î³Î®Ï‚ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ ${chart.id}:`, error);
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(12);
                    doc.text(greekToLatin('Sfalma kata tin eksagogi tou grafimatos'), 20, 50);
                }
            }
        }
        
        // Î¤ÎµÎ»Î¹ÎºÎ® ÏƒÎµÎ»Î¯Î´Î± Î¼Îµ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±
        doc.addPage();
        doc.setFont('helvetica', 'italic');
        doc.setFontSize(10);
        doc.text(`Dimiourgithe: ${new Date().toLocaleDateString('el-GR')}`, 20, 20);
        doc.text(greekToLatin('Ypologistis Kerdous Ana Kit - ProchorimenÄ« Ekdosi'), 20, 35);
        
        doc.save('profit-analysis-charts-fixed.pdf');
        this.showNotification('PDF Î¼Îµ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î± ÎµÎ¾Î®Ï‡Î¸Î· ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
        
    } catch (error) {
        console.error('PDF Charts Export Error:', error);
        this.showNotification('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® PDF: ' + error.message, 'error');
    }
}

// ÎÎ­Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± Excel Î¼Îµ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ Î³ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½
async exportExcelWithCharts() {
    try {
        this.showNotification('Î ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î± ÎµÎ¾Î±Î³Ï‰Î³Î®Ï‚ Excel...', 'info');
        
        const data = this.prepareExportData();
        
        // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
        if (this.calculationResults) {
            data.push({
                'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                'Î‘/Î‘': '',
                'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'Î£ÏÎ½Î¿Î»Î¿ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)': '',
                'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                'Î§ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ ÎšÎ¹Ï„': '',
                'ÎšÏŒÏƒÏ„Î¿Ï‚/ÎœÎ¿Î½Î¬Î´Î± (â‚¬)': '',
                'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': '100.00'
            });
            
            data.push({
                'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                'Î‘/Î‘': '',
                'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚',
                'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)': '',
                'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                'Î§ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ ÎšÎ¹Ï„': '',
                'ÎšÏŒÏƒÏ„Î¿Ï‚/ÎœÎ¿Î½Î¬Î´Î± (â‚¬)': '',
                'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.netProfit.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': ''
            });
        }
        
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ­ÏÎ´Î¿Ï…Ï‚');
        
        // Î¦ÏÎ»Î»Î¿ Î¼Îµ ÏƒÎµÎ½Î¬ÏÎ¹Î±
        if (this.calculationResults) {
            const scenarioData = [
                {
                    'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î¤ÏÎ­Ï‡Î¿Î½',
                    'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ (â‚¬)': this.calculationResults.salePrice.toFixed(2),
                    'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                    'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)': this.calculationResults.netProfit.toFixed(2),
                    'ROI (%)': this.calculationResults.roi.toFixed(2),
                    'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ (%)': this.calculationResults.profitOnCost.toFixed(2)
                },
                {
                    'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î‘Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ (+20%)',
                    'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ (â‚¬)': (this.calculationResults.salePrice * 1.2).toFixed(2),
                    'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                    'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)': ((this.calculationResults.salePrice * 1.2) - this.calculationResults.totalCost).toFixed(2),
                    'ROI (%)': (((this.calculationResults.salePrice * 1.2) - this.calculationResults.totalCost) / this.calculationResults.totalCost * 100).toFixed(2),
                    'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ (%)': (((this.calculationResults.salePrice * 1.2) - this.calculationResults.totalCost) / this.calculationResults.totalCost * 100).toFixed(2)
                },
                {
                    'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î‘Ï€Î±Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ (-20%)',
                    'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚ (â‚¬)': (this.calculationResults.salePrice * 0.8).toFixed(2),
                    'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                    'ÎšÎ­ÏÎ´Î¿Ï‚ (â‚¬)': ((this.calculationResults.salePrice * 0.8) - this.calculationResults.totalCost).toFixed(2),
                    'ROI (%)': (((this.calculationResults.salePrice * 0.8) - this.calculationResults.totalCost) / this.calculationResults.totalCost * 100).toFixed(2),
                    'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ (%)': (((this.calculationResults.salePrice * 0.8) - this.calculationResults.totalCost) / this.calculationResults.totalCost * 100).toFixed(2)
                }
            ];
            
            const scenarioWs = XLSX.utils.json_to_sheet(scenarioData);
            XLSX.utils.book_append_sheet(wb, scenarioWs, 'Î£ÎµÎ½Î¬ÏÎ¹Î±');
        }
        
        // Î¦ÏÎ»Î»Î¿ Î¼Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½ (ÏŒÏ‡Î¹ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚)
        const chartData = [];
        
        if (this.calculationResults) {
            // Pie Chart Data
            const pieTotal = this.calculationResults.ingredientsCost + this.calculationResults.additionalCostTotal + Math.max(this.calculationResults.netProfit, 0);
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'ÎšÎ±Ï„Î±Î½Î¿Î¼Î® ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'ÎšÏŒÏƒÏ„Î¿Ï‚ Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.ingredientsCost.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ((this.calculationResults.ingredientsCost / pieTotal) * 100).toFixed(2)
            });
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'ÎšÎ±Ï„Î±Î½Î¿Î¼Î® ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎšÏŒÏƒÏ„Î·',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.additionalCostTotal.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ((this.calculationResults.additionalCostTotal / pieTotal) * 100).toFixed(2)
            });
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'ÎšÎ±Ï„Î±Î½Î¿Î¼Î® ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'ÎšÎ­ÏÎ´Î¿Ï‚',
                'Î‘Î¾Î¯Î± (â‚¬)': Math.max(this.calculationResults.netProfit, 0).toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ((Math.max(this.calculationResults.netProfit, 0) / pieTotal) * 100).toFixed(2)
            });
            
            // Bar Chart Data
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.totalCost.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': '100'
            });
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.salePrice.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ((this.calculationResults.salePrice / this.calculationResults.totalCost) * 100).toFixed(2)
            });
            
            chartData.push({
                'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·',
                'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': 'ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚',
                'Î‘Î¾Î¯Î± (â‚¬)': this.calculationResults.netProfit.toFixed(2),
                'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': this.calculationResults.profitOnCost.toFixed(2)
            });
            
            // Î›ÎµÏ€Ï„Î¿Î¼ÎµÏÎ® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½
            this.ingredients.forEach((ingredient, index) => {
                chartData.push({
                    'Î¤ÏÏ€Î¿Ï‚ Î“ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚': 'Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½',
                    'ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±': ingredient.description,
                    'Î‘Î¾Î¯Î± (â‚¬)': ingredient.totalCost.toFixed(2),
                    'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ (%)': ((ingredient.totalCost / this.calculationResults.totalCost) * 100).toFixed(2)
                });
            });
        }
        
        const chartWs = XLSX.utils.json_to_sheet(chartData);
        XLSX.utils.book_append_sheet(wb, chartWs, 'Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î“ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½');
        
        // Î¦ÏÎ»Î»Î¿ Î¼Îµ Î¿Î´Î·Î³Î¯ÎµÏ‚ Î³Î¹Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½
        const instructionsData = [
            {
                'ÎŸÎ´Î·Î³Î¯ÎµÏ‚': 'Î“Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î± ÏƒÏ„Î¿ Excel:',
                'Î’Î®Î¼Î±': '1. Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€ÏŒ Ï„Î¿ Ï†ÏÎ»Î»Î¿ "Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î“ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½"'
            },
            {
                'ÎŸÎ´Î·Î³Î¯ÎµÏ‚': '',
                'Î’Î®Î¼Î±': '2. Î Î·Î³Î±Î¯Î½ÎµÏ„Îµ ÏƒÏ„Î¿ Insert > Charts'
            },
            {
                'ÎŸÎ´Î·Î³Î¯ÎµÏ‚': '',
                'Î’Î®Î¼Î±': '3. Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ (Pie, Column, Line)'
            },
            {
                'ÎŸÎ´Î·Î³Î¯ÎµÏ‚': '',
                'Î’Î®Î¼Î±': '4. Î ÏÎ¿ÏƒÎ±ÏÎ¼ÏŒÏƒÏ„Îµ Ï„Î¿Ï…Ï‚ Ï„Î¯Ï„Î»Î¿Ï…Ï‚ ÎºÎ±Î¹ Ï„Î· Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¯Î·ÏƒÎ·'
            },
            {
                'ÎŸÎ´Î·Î³Î¯ÎµÏ‚': 'Î ÏÎ¿Ï„ÎµÎ¹Î½ÏŒÎ¼ÎµÎ½Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î±:',
                'Î’Î®Î¼Î±': 'Pie Chart Î³Î¹Î± "ÎšÎ±Ï„Î±Î½Î¿Î¼Î® ÎšÏŒÏƒÏ„Î¿Ï…Ï‚"'
            },
            {
                'ÎŸÎ´Î·Î³Î¯ÎµÏ‚': '',
                'Î’Î®Î¼Î±': 'Column Chart Î³Î¹Î± "Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·"'
            },
            {
                'ÎŸÎ´Î·Î³Î¯ÎµÏ‚': '',
                'Î’Î®Î¼Î±': 'Doughnut Chart Î³Î¹Î± "Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½"'
            }
        ];
        
        const instructionsWs = XLSX.utils.json_to_sheet(instructionsData);
        XLSX.utils.book_append_sheet(wb, instructionsWs, 'ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î“ÏÎ±Ï†Î·Î¼Î¬Ï„Ï‰Î½');
        
        XLSX.writeFile(wb, 'profit-analysis-complete.xlsx');
        this.showNotification('Excel Î¼Îµ Ï€Î»Î®ÏÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÎµÎ¾Î®Ï‡Î¸Î· ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
        
    } catch (error) {
        console.error('Excel Export Error:', error);
        this.showNotification('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® Excel: ' + error.message, 'error');
    }
}

// Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· helper Î¼ÎµÎ¸ÏŒÎ´Î¿Ï… Î³Î¹Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ· ÎµÎ¾Î±Î³Ï‰Î³Î® ÎµÎ¹ÎºÏŒÎ½Ï‰Î½
async captureChartAsImage(chartId) {
    return new Promise((resolve) => {
        const canvas = document.getElementById(chartId);
        if (!canvas) {
            resolve(null);
            return;
        }
        
        // Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Î»Î¯Î³Î¿ Î³Î¹Î± Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¸ÎµÎ¯ Ï„Î¿ rendering
        setTimeout(() => {
            try {
                // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… canvas Î¼Îµ Î»ÎµÏ…ÎºÏŒ background
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                
                // Î›ÎµÏ…ÎºÏŒ background
                tempCtx.fillStyle = '#ffffff';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                
                // Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Ï„Î¿Ï… Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚
                tempCtx.drawImage(canvas, 0, 0);
                
                // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® base64 ÎµÎ¹ÎºÏŒÎ½Î±Ï‚
                const imgData = tempCanvas.toDataURL('image/png', 1.0);
                resolve(imgData);
            } catch (error) {
                console.error('Î£Ï†Î¬Î»Î¼Î± capture Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚:', error);
                resolve(null);
            }
        }, 300);
    });
}



            exportExcel() {
                try {
                    const data = this.prepareExportData();
                    
                    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
                    if (this.calculationResults) {
                        data.push({
                            'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                            'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'Î£ÏÎ½Î¿Î»Î¿ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                            'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                            'Î Î¿ÏƒÏŒÏ„Î·Ï„Î±': '',
                            'Î§ÏÎ®ÏƒÎ·': '',
                            'ÎšÏŒÏƒÏ„Î¿Ï‚': this.calculationResults.totalCost.toFixed(2)
                        });
                        
                        data.push({
                            'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                            'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚',
                            'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                            'Î Î¿ÏƒÏŒÏ„Î·Ï„Î±': '',
                            'Î§ÏÎ®ÏƒÎ·': '',
                            'ÎšÏŒÏƒÏ„Î¿Ï‚': this.calculationResults.netProfit.toFixed(2)
                        });
                        
                        data.push({
                            'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                            'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÏ€Î¯ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                            'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                            'Î Î¿ÏƒÏŒÏ„Î·Ï„Î±': '',
                            'Î§ÏÎ®ÏƒÎ·': '',
                            'ÎšÏŒÏƒÏ„Î¿Ï‚': this.calculationResults.profitOnCost.toFixed(2) + '%'
                        });
                        
                        data.push({
                            'Î¤ÏÏ€Î¿Ï‚': 'Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±',
                            'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': 'ROI',
                            'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                            'Î Î¿ÏƒÏŒÏ„Î·Ï„Î±': '',
                            'Î§ÏÎ®ÏƒÎ·': '',
                            'ÎšÏŒÏƒÏ„Î¿Ï‚': this.calculationResults.roi.toFixed(2) + '%'
                        });
                    }
                    
                    const ws = XLSX.utils.json_to_sheet(data);
                    
                    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Ï…Î» ÏƒÏ„Î¿ Excel
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Î ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½Î· Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ­ÏÎ´Î¿Ï…Ï‚');
                    
                    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÏÏ„ÎµÏÎ¿Ï… Ï†ÏÎ»Î»Î¿Ï… Î¼Îµ ÏƒÎµÎ½Î¬ÏÎ¹Î±
                    if (this.calculationResults) {
                        const scenarioData = [
                            {
                                'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î¤ÏÎ­Ï‡Î¿Î½',
                                'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚': this.calculationResults.salePrice.toFixed(2),
                                'ÎšÏŒÏƒÏ„Î¿Ï‚': this.calculationResults.totalCost.toFixed(2),
                                'ÎšÎ­ÏÎ´Î¿Ï‚': this.calculationResults.netProfit.toFixed(2),
                                'ROI': this.calculationResults.roi.toFixed(2) + '%'
                            },
                            {
                                'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î‘Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ (+20%)',
                                'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚': (this.calculationResults.salePrice * 1.2).toFixed(2),
                                'ÎšÏŒÏƒÏ„Î¿Ï‚': this.calculationResults.totalCost.toFixed(2),
                                'ÎšÎ­ÏÎ´Î¿Ï‚': (this.calculationResults.netProfit * 1.2).toFixed(2),
                                'ROI': (this.calculationResults.roi * 1.2).toFixed(2) + '%'
                            },
                            {
                                'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î‘Ï€Î±Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ (-20%)',
                                'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚': (this.calculationResults.salePrice * 0.8).toFixed(2),
                                'ÎšÏŒÏƒÏ„Î¿Ï‚': this.calculationResults.totalCost.toFixed(2),
                                'ÎšÎ­ÏÎ´Î¿Ï‚': (this.calculationResults.netProfit * 0.8).toFixed(2),
                                'ROI': (this.calculationResults.roi * 0.8).toFixed(2) + '%'
                            },
                            {
                                'Î£ÎµÎ½Î¬ÏÎ¹Î¿': 'Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒ (-10%)',
                                'Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚': (this.calculationResults.salePrice * 0.9).toFixed(2),
                                'ÎšÏŒÏƒÏ„Î¿Ï‚': this.calculationResults.totalCost.toFixed(2),
                                'ÎšÎ­ÏÎ´Î¿Ï‚': (this.calculationResults.netProfit * 0.9).toFixed(2),
                                'ROI': (this.calculationResults.roi * 0.9).toFixed(2) + '%'
                            }
                        ];
                        
                        const scenarioWs = XLSX.utils.json_to_sheet(scenarioData);
                        XLSX.utils.book_append_sheet(wb, scenarioWs, 'Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£ÎµÎ½Î±ÏÎ¯Ï‰Î½');
                    }
                    
                    XLSX.writeFile(wb, 'profit-analysis-advanced.xlsx');
                } catch (error) {
                    alert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® Excel: ' + error.message);
                }
            }

            prepareExportData() {
                const data = [];
                
                // Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ Î¼Îµ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎ® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±
                this.ingredients.forEach((ingredient, index) => {
                    data.push({
                        'Î¤ÏÏ€Î¿Ï‚': 'Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏŒ',
                        'Î‘/Î‘': index + 1,
                        'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': ingredient.description,
                        'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)': ingredient.batchPrice.toFixed(2),
                        'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚': ingredient.quantity,
                        'Î§ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ ÎšÎ¹Ï„': ingredient.usage,
                        'ÎšÏŒÏƒÏ„Î¿Ï‚/ÎœÎ¿Î½Î¬Î´Î± (â‚¬)': ingredient.costPerUnit.toFixed(4),
                        'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': ingredient.totalCost.toFixed(2),
                        'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': this.calculationResults ? 
                            ((ingredient.totalCost / this.calculationResults.totalCost) * 100).toFixed(2) : '0'
                    });
                });
                
                // Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎºÏŒÏƒÏ„Î·
                this.additionalCosts.forEach((cost, index) => {
                    data.push({
                        'Î¤ÏÏ€Î¿Ï‚': 'Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎšÏŒÏƒÏ„Î¿Ï‚',
                        'Î‘/Î‘': index + 1,
                        'Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®': cost.description,
                        'Î¤Î¹Î¼Î® Î Î±ÏÏ„Î¯Î´Î±Ï‚ (â‚¬)': '',
                        'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± Î Î±ÏÏ„Î¯Î´Î±Ï‚': '',
                        'Î§ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ ÎšÎ¹Ï„': '',
                        'ÎšÏŒÏƒÏ„Î¿Ï‚/ÎœÎ¿Î½Î¬Î´Î± (â‚¬)': '',
                        'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)': cost.cost.toFixed(2),
                        'Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÏŒÏƒÏ„Î¿Ï…Ï‚ (%)': this.calculationResults ? 
                            ((cost.cost / this.calculationResults.totalCost) * 100).toFixed(2) : '0'
                    });
                });
                
                return data;
            }

            convertToCSV(data) {
                if (data.length === 0) return '';
                
                const headers = Object.keys(data[0]);
                const csvContent = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => {
                        const value = row[header] || '';
                        return `"${value.toString().replace(/"/g, '""')}"`;
                    }).join(','))
                ].join('\n');
                
                return '\ufeff' + csvContent; // Add BOM for proper UTF-8 encoding
            }

            downloadFile(content, filename, contentType) {
                const blob = new Blob([content], { type: contentType });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }

            // ÎÎ­ÎµÏ‚ Î¼Î­Î¸Î¿Î´Î¿Î¹ Î³Î¹Î± Ï€ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½Î· Î±Î½Î¬Î»Ï…ÏƒÎ·
            calculateBreakEvenPoint() {
                if (!this.calculationResults) return 0;
                return this.calculationResults.totalCost;
            }

            calculateMarginOfSafety() {
                if (!this.calculationResults) return 0;
                const breakEven = this.calculateBreakEvenPoint();
                return this.calculationResults.salePrice - breakEven;
            }

            calculatePriceElasticity(priceChange) {
                if (!this.calculationResults) return 0;
                const originalProfit = this.calculationResults.netProfit;
                const newPrice = this.calculationResults.salePrice * (1 + priceChange);
                const newProfit = newPrice - this.calculationResults.totalCost;
                return ((newProfit - originalProfit) / originalProfit) / priceChange;
            }

            generateRecommendations() {
                if (!this.calculationResults) return [];
                
                const recommendations = [];
                const results = this.calculationResults;
                
                // Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎºÎµÏÎ´Î¿Ï†Î¿ÏÎ¯Î±Ï‚
                if (results.profitOnCost < 15) {
                    recommendations.push({
                        type: 'warning',
                        title: 'Î§Î±Î¼Î·Î»Î® ÎšÎµÏÎ´Î¿Ï†Î¿ÏÎ¯Î±',
                        message: 'Î¤Î¿ Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î¿ ÎºÎ­ÏÎ´Î¿Ï…Ï‚ ÎµÎ¯Î½Î±Î¹ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ 15%. Î£Ï…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î±ÏÎ¾Î·ÏƒÎ· Ï„Î¹Î¼Î®Ï‚ Î® Î¼ÎµÎ¯Ï‰ÏƒÎ· ÎºÏŒÏƒÏ„Î¿Ï…Ï‚.',
                        priority: 'high'
                    });
                }
                
                if (results.profitOnCost > 50) {
                    recommendations.push({
                        type: 'success',
                        title: 'Î•Î¾Î±Î¹ÏÎµÏ„Î¹ÎºÎ® ÎšÎµÏÎ´Î¿Ï†Î¿ÏÎ¯Î±',
                        message: 'Î Î¿Î»Ï Ï…ÏˆÎ·Î»ÏŒ Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î¿ ÎºÎ­ÏÎ´Î¿Ï…Ï‚. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¼ÎµÎ¹ÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï„Î¹Î¼Î® Î³Î¹Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ· Î±Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒÏ„Î·Ï„Î±.',
                        priority: 'medium'
                    });
                }
                
                // Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎºÏŒÏƒÏ„Î¿Ï…Ï‚ ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½
                if (this.ingredients.length > 0) {
                    const mostExpensive = this.ingredients.reduce((max, ingredient) => 
                        ingredient.totalCost > max.totalCost ? ingredient : max
                    );
                    
                    if (mostExpensive.totalCost > results.totalCost * 0.3) {
                        recommendations.push({
                            type: 'info',
                            title: 'Î’ÎµÎ»Ï„Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎšÏŒÏƒÏ„Î¿Ï…Ï‚',
                            message: `Î¤Î¿ ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÏŒ "${mostExpensive.description}" Î±Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Ï„Î¿ ${((mostExpensive.totalCost / results.totalCost) * 100).toFixed(1)}% Ï„Î¿Ï… ÎºÏŒÏƒÏ„Î¿Ï…Ï‚. Î•Î¾ÎµÏ„Î¬ÏƒÏ„Îµ ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ­Ï‚.`,
                            priority: 'medium'
                        });
                    }
                }
                
                // ROI Î±Î½Î¬Î»Ï…ÏƒÎ·
                if (results.roi < 20) {
                    recommendations.push({
                        type: 'warning',
                        title: 'Î§Î±Î¼Î·Î»ÏŒ ROI',
                        message: 'Î¤Î¿ ROI ÎµÎ¯Î½Î±Î¹ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ 20%. Î•Î¾ÎµÏ„Î¬ÏƒÏ„Îµ Ï„Î· Î²Î¹Ï‰ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± Ï„Î¿Ï… Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚.',
                        priority: 'high'
                    });
                }
                
                return recommendations;
            }

            displayRecommendations() {
                const recommendations = this.generateRecommendations();
                
                // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± HTML Î³Î¹Î± ÏƒÏ…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚
                const recommendationsHTML = recommendations.map(rec => `
                    <div class="recommendation ${rec.type} ${rec.priority}">
                        <h4>${rec.title}</h4>
                        <p>${rec.message}</p>
                    </div>
                `).join('');
                
                // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ DOM Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î·
                let recommendationsContainer = document.getElementById('recommendationsContainer');
                if (!recommendationsContainer) {
                    recommendationsContainer = document.createElement('div');
                    recommendationsContainer.id = 'recommendationsContainer';
                    recommendationsContainer.className = 'recommendations-section';
                    recommendationsContainer.innerHTML = `
                        <h3>ğŸ¯ Î£Ï…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚</h3>
                        <div class="recommendations-list"></div>
                    `;
                    
                    const analysisSection = document.querySelector('.analysis-section');
                    if (analysisSection) {
                        analysisSection.appendChild(recommendationsContainer);
                    }
                }
                
                const recommendationsList = recommendationsContainer.querySelector('.recommendations-list');
                if (recommendationsList) {
                    recommendationsList.innerHTML = recommendationsHTML;
                }
            }

            // ÎœÎ­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± real-time validation
            validateInputs() {
                const inputs = document.querySelectorAll('input[type="number"]');
                inputs.forEach(input => {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (isNaN(value) || value < 0) {
                            e.target.style.borderColor = '#ff4444';
                            e.target.title = 'Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î­Î³ÎºÏ…ÏÎ· Î¸ÎµÏ„Î¹ÎºÎ® Ï„Î¹Î¼Î®';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.title = '';
                        }
                    });
                });
            }

            // ÎœÎ­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
            setupAutoSave() {
                const autoSaveData = () => {
                    const data = {
                        ingredients: this.ingredients,
                        additionalCosts: this.additionalCosts,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem('profitCalculatorData', JSON.stringify(data));
                };

                // Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎºÎ¬Î¸Îµ 30 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
                setInterval(autoSaveData, 30000);
                
                // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î­Î¾Î¿Î´Î¿
                window.addEventListener('beforeunload', autoSaveData);
            }

            // ÎœÎ­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
            loadSavedData() {
                try {
                    const savedData = localStorage.getItem('profitCalculatorData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        
                        // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÎµÎ¯Î½Î±Î¹ Ï€ÏÏŒÏƒÏ†Î±Ï„Î± (Î¼Î­ÏƒÎ± ÏƒÏ„Î¹Ï‚ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯ÎµÏ‚ 24 ÏÏÎµÏ‚)
                        const savedTime = new Date(data.timestamp);
                        const now = new Date();
                        const hoursDiff = (now - savedTime) / (1000 * 60 * 60);
                        
                        if (hoursDiff < 24) {
                            this.ingredients = data.ingredients || [];
                            this.additionalCosts = data.additionalCosts || [];
                            this.renderIngredients();
                            this.renderAdditionalCosts();
                            
                            // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚
                            this.showNotification('Î¦Î¿ÏÏ„ÏÎ¸Î·ÎºÎ±Î½ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±', 'success');
                        }
                    }
                } catch (error) {
                    console.warn('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½:', error);
                }
            }

            // ÎœÎ­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <span>${message}</span>
                    <button onclick="this.parentElement.remove()">Ã—</button>
                `;
                
                // Î£Ï„Ï…Î» Î³Î¹Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--bg-card);
                    border: 2px solid var(--accent-color);
                    color: var(--text-primary);
                    padding: 15px 20px;
                    border-radius: 10px;
                    box-shadow: var(--shadow);
                    z-index: 1000;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    max-width: 300px;
                    animation: slideIn 0.3s ease;
                `;
                
                if (type === 'success') {
                    notification.style.borderColor = '#00ff88';
                } else if (type === 'warning') {
                    notification.style.borderColor = '#ffaa00';
                } else if (type === 'error') {
                    notification.style.borderColor = '#ff4444';
                }
                
                document.body.appendChild(notification);
                
                // Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Ï†Î±Î¯ÏÎµÏƒÎ· Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ 5 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 5000);
            }

            // ÎœÎ­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± ÎµÎ¾Î±Î³Ï‰Î³Î® ÏƒÎµ JSON
            exportJSON() {
                const data = {
                    metadata: {
                        version: '2.0',
                        created: new Date().toISOString(),
                        title: 'Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„'
                    },
                    ingredients: this.ingredients,
                    additionalCosts: this.additionalCosts,
                    results: this.calculationResults,
                    scenarios: this.generateScenarioData()
                };
                
                const jsonString = JSON.stringify(data, null, 2);
                this.downloadFile(jsonString, 'profit-analysis.json', 'application/json');
            }

            generateScenarioData() {
                if (!this.calculationResults) return [];
                
                return [
                    {
                        name: 'Î¤ÏÎ­Ï‡Î¿Î½',
                        multiplier: 1.0,
                        profit: this.calculationResults.netProfit,
                        roi: this.calculationResults.roi
                    },
                    {
                        name: 'Î‘Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿',
                        multiplier: 1.2,
                        profit: this.calculationResults.netProfit * 1.2,
                        roi: this.calculationResults.roi * 1.2
                    },
                    {
                        name: 'Î‘Ï€Î±Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿',
                        multiplier: 0.8,
                        profit: this.calculationResults.netProfit * 0.8,
                        roi: this.calculationResults.roi * 0.8
                    },
                    {
                        name: 'Î‘Î½Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÏŒ',
                        multiplier: 0.9,
                        profit: this.calculationResults.netProfit * 0.9,
                        roi: this.calculationResults.roi * 0.9
                    }
                ];
            }

            // Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½
            initialize() {
                this.validateInputs();
                this.setupAutoSave();
                this.loadSavedData();
                
                // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï Î³Î¹Î± JSON export
                const exportButtons = document.querySelector('.export-buttons');
                if (exportButtons) {
                    const jsonBtn = document.createElement('button');
                    jsonBtn.className = 'export-btn json';
                    jsonBtn.style.background = '#9966ff';
                    jsonBtn.style.color = 'white';
                    jsonBtn.innerHTML = 'ğŸ“‹ Î•Î¾Î±Î³Ï‰Î³Î® JSON';
                    jsonBtn.addEventListener('click', () => this.exportJSON());
                    exportButtons.appendChild(jsonBtn);
                }
                
                console.log('Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ ÎšÎ­ÏÎ´Î¿Ï…Ï‚ Î‘Î½Î¬ ÎšÎ¹Ï„ - Î ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½Î· ÎˆÎºÎ´Î¿ÏƒÎ· Î±ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!');
            }
        }

        // Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚
        let calculator;
        document.addEventListener('DOMContentLoaded', function() {
            calculator = new ProfitCalculator();
            calculator.initialize();
            
            // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· CSS Î³Î¹Î± animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                
                .recommendation {
                    margin: 10px 0;
                    padding: 15px;
                    border-radius: 8px;
                    border-left: 4px solid;
                }
                
                .recommendation.success {
                    background: rgba(0, 255, 136, 0.1);
                    border-left-color: #00ff88;
                }
                
                .recommendation.warning {
                    background: rgba(255, 170, 0, 0.1);
                    border-left-color: #ffaa00;
                }
                
                .recommendation.info {
                    background: rgba(0, 212, 255, 0.1);
                    border-left-color: #00d4ff;
                }
                
                .recommendation h4 {
                    margin: 0 0 5px 0;
                    font-size: 1.1rem;
                }
                
                .recommendation p {
                    margin: 0;
                    font-size: 0.9rem;
                    opacity: 0.9;
                }
                
                .recommendations-section {
                    margin-top: 20px;
                }
                
                .export-btn.json:hover {
                    transform: translateY(-2px);
                    box-shadow: var(--shadow);
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
